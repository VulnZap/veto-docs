---
title: TypeScript SDK
description: Full API reference for the Veto TypeScript SDK (v1.4.0).
---

## Installation

```bash
npm install veto-sdk
```

## `Veto.init(options?)`

Initialize Veto. Loads configuration from `./veto` by default.

```typescript
import { Veto } from 'veto-sdk';

const veto = await Veto.init();
```

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `configDir` | `string` | `"./veto"` | Path to config directory |
| `mode` | `"strict" \| "log"` | `"strict"` | Operating mode |
| `logLevel` | `string` | `"info"` | Log level |
| `sessionId` | `string` | — | Session ID for tracking |
| `agentId` | `string` | — | Agent ID for tracking |
| `validators` | `Validator[]` | — | Additional validators |
| `cloudClient` | `VetoCloudClient` | — | Injected cloud client |
| `onApprovalRequired` | `(context, approvalId) => void` | — | Hook fired when a tool call needs human approval |

## `veto.wrap<T>(tools: T[]): T[]`

Wraps an array of tools with validation. The returned tools have identical types — fully compatible with your AI framework.

```typescript
const wrappedForLangChain = veto.wrap(langChainTools);
const wrappedForVercel = veto.wrap(vercelTools);
```

Works with LangChain, Vercel AI SDK, OpenAI function calling, Anthropic tool use, and custom tool objects.

## `veto.wrapTool<T>(tool: T): T`

Wraps a single tool instance.

```typescript
const safeTool = veto.wrapTool(myTool);
```

## `veto.getHistoryStats()`

Returns statistics about validation decisions.

```typescript
const stats = veto.getHistoryStats();
// { totalCalls: 5, allowedCalls: 4, deniedCalls: 1, ... }
```

## `veto.clearHistory()`

Resets the history statistics.

```typescript
veto.clearHistory();
```

## Error handling

When a tool call is blocked, Veto throws a `ToolCallDeniedError`:

```typescript
import { ToolCallDeniedError } from 'veto-sdk';

try {
  await wrappedTool.invoke(args);
} catch (error) {
  if (error instanceof ToolCallDeniedError) {
    console.log(error.message);  // "Tool call denied: limit-transfers"
    console.log(error.ruleId);   // "limit-transfers"
  }
}
```

When an approval poll times out, Veto throws an `ApprovalTimeoutError`:

```typescript
import { ApprovalTimeoutError } from 'veto-sdk/cloud';

try {
  await wrappedTool.invoke(args);
} catch (error) {
  if (error instanceof ApprovalTimeoutError) {
    console.log(error.approvalId);  // "apr_abc123"
    console.log(error.timeoutMs);   // 300000
  }
}
```

## Cloud validation and approvals

When using `cloud` validation mode, the SDK routes tool calls through the Veto Cloud API. The server can return three decisions: `allow`, `deny`, or `require_approval`.

When a tool call requires approval, the SDK:

1. Fires the `onApprovalRequired` hook (so your app can show approval UI)
2. Polls `GET /v1/approvals/:id` until a human approves or denies
3. Returns the final decision to the agent

```typescript
const veto = await Veto.init({
  onApprovalRequired: (context, approvalId) => {
    // Show approval UI to the user
    console.log(`Tool "${context.toolName}" needs approval: ${approvalId}`);
  },
});
```

### Configuration

Configure approval polling in `veto.config.yaml`:

```yaml
validation:
  mode: "cloud"

cloud:
  apiKey: "veto_abc123..."
  baseUrl: "https://api.runveto.com"

approval:
  pollInterval: 2000   # ms between polls (default: 2000)
  timeout: 300000      # max ms to wait (default: 300000 = 5 min)
```

### Approval preference cache

Cache per-tool preferences to auto-resolve approvals without server polling:

```typescript
// Auto-approve all future calls to "read_file"
veto.setApprovalPreference('read_file', 'approve_all');

// Auto-deny all future calls to "delete_database"
veto.setApprovalPreference('delete_database', 'deny_all');

// Check current preference
veto.getApprovalPreference('read_file'); // "approve_all"

// Clear preference for one tool
veto.clearApprovalPreferences('read_file');

// Clear all preferences
veto.clearApprovalPreferences();
```

## Client-side deterministic validation

When using cloud mode, the SDK can evaluate deterministic constraints locally — no network round-trip needed. Policies are fetched from the cloud and cached with a stale-while-revalidate strategy.

This is automatic. When the SDK has a cached policy for a tool and that policy uses `deterministic` mode without session constraints or rate limits, validation runs entirely in the SDK. The decision is logged back to the server asynchronously so the dashboard stays accurate.

```
Agent calls tool
       │
       ▼
Check PolicyCache ─── cache miss ─── POST /v1/validate (server)
       │
  cache hit (deterministic, no session/rate constraints)
       │
       ▼
Run local validation
       │
       ├── allow ─── Tool executes
       │
       └── deny ─── ToolCallDeniedError
       │
  POST /v1/decisions (fire-and-forget)
```

### Supported constraint types

| Constraint | Applies to | Description |
|-----------|-----------|-------------|
| `required` | all | Argument must be present |
| `notNull` | all | Argument cannot be null |
| `minimum` | numbers | Lower bound (inclusive) |
| `maximum` | numbers | Upper bound (inclusive) |
| `greaterThan` | numbers | Lower bound (exclusive) |
| `lessThan` | numbers | Upper bound (exclusive) |
| `minLength` | strings | Minimum string length |
| `maxLength` | strings | Maximum string length |
| `enum` | strings | Allowed exact values |
| `regex` | strings | Pattern match (max 256 chars, ReDoS-safe) |
| `minItems` | arrays | Minimum array length |
| `maxItems` | arrays | Maximum array length |

### Policy cache

Policies are cached with two time windows:

| Window | Default | Behavior |
|--------|---------|----------|
| Fresh | 60s | Returns cached policy immediately |
| Max age | 5min | Returns stale policy while refreshing in background |

After max age, the cache entry expires and the next validation falls through to the server. Background refreshes are deferred to avoid blocking the current validation.

```typescript
// PolicyCache is initialized automatically in cloud mode.
// No configuration needed — it uses sensible defaults.
```

## `VetoCloudClient`

Standalone client for direct cloud API interaction. Used internally by `Veto`, but also available for advanced use cases.

```typescript
import { VetoCloudClient } from 'veto-sdk/cloud';

const client = new VetoCloudClient({
  config: {
    apiKey: 'veto_abc123...',
    baseUrl: 'https://api.runveto.com',
    timeout: 30000,
    retries: 2,
    retryDelay: 1000,
  },
  logger,
});
```

### `client.validate(toolName, args, context?)`

Validate a tool call against cloud policies.

```typescript
const result = await client.validate('send_email', {
  to: 'user@example.com',
  subject: 'Hello',
});
// { decision: "allow" | "deny" | "require_approval", reason?, approval_id? }
```

### `client.pollApproval(approvalId, options?)`

Poll an approval record until resolved or timed out.

```typescript
const approval = await client.pollApproval('apr_abc123', {
  pollInterval: 2000,  // ms
  timeout: 300000,     // ms
});
// { id, toolName, status: "approved" | "denied" | "expired", resolvedBy? }
```

### `client.fetchPolicy(toolName)`

Fetch a tool's policy from the server. Used by `PolicyCache` for background refreshes.

```typescript
const policy = await client.fetchPolicy('send_email');
// { toolName, mode, constraints, sessionConstraints?, rateLimits?, version }
// Returns null on error (404, network failure, etc.)
```

### `client.logDecision(request)`

Log a client-side validation decision to the server. Fire-and-forget — errors are silently swallowed.

```typescript
client.logDecision({
  tool_name: 'send_email',
  arguments: { to: 'user@example.com' },
  decision: 'allow',
  mode: 'deterministic',
  latency_ms: 2,
  source: 'client',
});
```

### `client.registerTools(tools)`

Register tool signatures with the cloud for policy generation.

```typescript
await client.registerTools([{
  name: 'send_email',
  description: 'Send an email',
  parameters: [
    { name: 'to', type: 'string', required: true },
    { name: 'subject', type: 'string', required: true },
    { name: 'body', type: 'string', required: true },
  ],
}]);
```

## Provider adapters

The SDK includes adapters that convert tool definitions between formats:

```typescript
import { adapters } from 'veto-sdk/providers';

// Convert OpenAI tools to Anthropic format
const anthropicTools = adapters.toAnthropic(openAITools);

// Convert Anthropic tools to OpenAI format
const openAITools = adapters.toOpenAI(anthropicTools);
```

## Exports

The SDK publishes multiple entry points:

| Import | What it provides |
|--------|-----------------|
| `veto-sdk` | Core `Veto` class, types, errors |
| `veto-sdk/providers` | Provider adapters (OpenAI, Anthropic, Google) |
| `veto-sdk/rules` | Rule parsing and matching utilities |
| `veto-sdk/kernel` | Local model evaluation via Ollama |
| `veto-sdk/custom` | Direct LLM provider integration |
| `veto-sdk/compiler` | Rule compiler utilities |
| `veto-sdk/benchmark` | Performance benchmarking |
